<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <title>Détail produit</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin:28px; background:#f7f8fb; color:#111; }
    .card { background:white; padding:18px; border-radius:8px; box-shadow:0 4px 12px rgba(0,0,0,0.06); max-width:1000px; margin:auto; }
    h1 { margin-top:0; }
    table { width:100%; border-collapse:collapse; margin-top:12px; }
    td { padding:8px 10px; vertical-align:top; border-bottom:1px solid #eee; }
    td.key { width:220px; font-weight:600; color:#333; background:#fafafa; }
    .back { margin-bottom:14px; display:inline-block; }
  </style>
</head>
<body>
  <a class="back" href="catalogue.html">← Retour</a>
  <div id="content" class="card">
    <h1>Chargement…</h1>
    <div id="details"></div>
  </div>

  <script>
  // Config : même source que catalogue.html
  const sheetID = "1ziYU_8TEzZey5zwPWsEty3Ufimp8VxFp9uRGjw5ou4k";          // <-- Remplace par l'ID
  const sheetName = "1";          // <-- Nom de l'onglet
  const apiURL = `https://opensheet.elk.sh/${sheetID}/${encodeURIComponent(sheetName)}`;

  // Récupérer param ?product=...
  function getParam(name) {
    const url = new URL(window.location.href);
    return url.searchParams.get(name);
  }

  const desiredProduct = getParam('product');

  if(!desiredProduct) {
    $('#content').html('<h2>Produit non spécifié dans l’URL.</h2><p>Exemple : detail.html?product=Essai%20Alpha%20001</p>');
  } else {
    $.getJSON(apiURL).done(function(data){
      if(!data || data.length === 0) {
        $('#content').html('<p>Erreur : aucune donnée trouvée depuis le Google Sheet.</p>');
        return;
      }

      // find row by product name (case-insensitive exact match)
      const target = decodeURIComponent(desiredProduct).toLowerCase();
      let found = data.find(r => (r['Nom du Produit']||'').toLowerCase() === target);
      if(!found) {
        // fallback: partial match
        found = data.find(r => (r['Nom du Produit']||'').toLowerCase().includes(target));
      }

      if(!found) {
        $('#content').html(`<h2>Produit introuvable :</h2><p>Recherche : <strong>${desiredProduct}</strong></p>`);
        return;
      }

      // Build detail table: list all keys
      const $details = $('<table></table>');
      Object.keys(found).forEach(key => {
        const val = found[key] || '';
        let displayVal = $('<div>').text(val).html(); // escape
        // if it's a link-looking value, render as anchor
        if (String(val).startsWith('http://') || String(val).startsWith('https://')) {
          displayVal = `<a href="${val}" target="_blank" rel="noopener">${val}</a>`;
        }
        $details.append(`<tr><td class="key">${key}</td><td class="value">${displayVal}</td></tr>`);
      });

      $('#content').html(`<h1>${found['Nom du Produit'] || 'Détail produit'}</h1>`);
      $('#content').append($details);
    }).fail(function(){
      $('#content').html('<p>Erreur lors du chargement du Google Sheet.</p>');
    });
  }
  </script>
</body>
</html>
